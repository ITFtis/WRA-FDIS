!function(n){"use strict";var i="temp__",a=function(t,e){e&&(e.stopPropagation(),e.preventDefault()),this.$element=n(t),this.settings={}};a.prototype={constructor:a,init:function(t){n.extend(this.settings,t),console.log(i+" init")}},n.fn[i]=function(o){this.each(function(){var t,e=n(this).data(i);if(e||(n(this).data(i,new a(this)),e=n(this).data(i)),void 0===o||"object"==typeof o)"function"==typeof e.init&&e.init(o);else{if("string"==typeof o&&"function"==typeof e[o])return t=Array.prototype.slice.call(arguments,1),e[o].apply(e,t);n.error("Method "+o+" does not exist on jQuery."+i)}})}}(jQuery);var whatMap=function(t){return null==t&&alert("map is null at whatMap"),t.overlayMapTypes?"google":t.hasOwnProperty("_leaflet_id")?"leaflet":t.hasOwnProperty("dragRotate")?"golife":"arcgis"};!function(w){"use strict";var a=function(t,e){if(t)for(var o=0,n=0;n<t.length;n++)w.getScript(t[n],function(){o++,t.length==o&&e()})};function t(t){var e=document.getElementsByTagName("script");if(e&&0<e.length)for(var o in e){if(e[o].src&&e[o].src.match(new RegExp(t+"\\.js$")))return e[o].src.replace(new RegExp("(.*)"+t+"\\.js$"),"$1");if(e[o].src&&e[o].src.match(new RegExp(t+".min\\.js$")))return e[o].src.replace(new RegExp("(.*)"+t+".min\\.js$"),"$1")}}w.AppConfigOptions=w.extend({script:{},default_loading_icon:void 0},w.AppConfigOptions,!0),!w.AppConfigOptions.script.gispath&&t("gis/Main")&&(w.AppConfigOptions.script.gispath=t("gis/Main")+"gis"),!w.AppConfigOptions.script.gispath&&window.app&&app.siteRoot&&(w.AppConfigOptions.script.gispath=app.siteRoot+"Scripts/gis"),w.AppConfigOptions.default_loading||(w.AppConfigOptions.default_loading={icon:w.AppConfigOptions.script.gispath+"/images/loading/loading_black.gif",size:"0.9em"}),w.AppConfigOptions.def={},w.AppConfigOptions.def.typh={name:"typh",js:"/ext/typh/Typh.js"},w.AppConfigOptions.def.cloud={name:"cloud",js:"/ext/cloud/Cloud.js"},w.AppConfigOptions.def.drawtool={name:"gisdrawtool",js:"/ext/draw/Drawtool.js"},w.AppConfigOptions.def.mapBaseLayer={name:"MapBaseLayer",js:"/ext/baselayer/MapBaseLayer.js"},w.AppConfigOptions.def.coordinateInfo={name:"CoordinateInfo",js:"/ext/info/CoordinateInfo.js"},w.AppConfigOptions.def.export={name:"ExportMap",js:"/ext/export/ExportMap.js"},w.AppConfigOptions.def.basepinctrl={name:"BasePinCtrl",js:"/ext/meter/BasePinCtrl.js"},w.AppConfigOptions.def.pinctrl={name:"PinCtrl",js:"/ext/meter/PinCtrl.js"},w.AppConfigOptions.def.polygonctrl={name:"PolygonCtrl",js:"/ext/meter/PolygonCtrl.js"},w.AppConfigOptions.def.polylinectrl={name:"PolylineCtrl",js:"/ext/meter/PolylineCtrl.js"},w.AppConfigOptions.def.kmlctrl={name:"KmlCtrl",js:"/ext/meter/KmlCtrl.js"},w.AppConfigOptions.def.waterctrl={name:"WaterCtrl",js:"/ext/meter/WaterCtrl.js"},w.AppConfigOptions.def.rainctrl={name:"RainCtrl",js:"/ext/meter/RainCtrl.js"},w.AppConfigOptions.def.cctvctrl={name:"CctvCtrl",js:"/ext/meter/CctvCtrl.js"},w.AppConfigOptions.def.boundary={name:"Boundary",js:"/ext/boundary/Boundary.js"},w.AppConfigOptions.def.boundaryMap={name:"BoundaryMap",js:"/ext/boundary/BoundaryMap.js"},w.AppConfigOptions.def.boundaryLayer={name:"BoundaryLayer",js:"/ext/boundary/BoundaryLayer.js"},w.AppConfigOptions.def.boundaryFeatureLayer={name:"BoundaryFeatureLayer",js:"/ext/arcgis/BoundaryFeatureLayer.js"},w.AppConfigOptions.def.localKml={name:"LocalKml",js:"/ext/kml/LocalKml.js"},w.AppConfigOptions.def.basePosition={name:"BasePosition",js:"/ext/position/BasePosition.js"},w.AppConfigOptions.def.districtPosition={name:"DistrictPosition",js:"/ext/position/DistrictPosition.js"},w.AppConfigOptions.def.addressGeocode={name:"addressGeocode",js:"/ext/geocode/AddressGeocode.js"},w.AppConfigOptions.require={},w.AppConfigOptions.require.request=function(t,e){var o,n=[],i=function(){0<n.length?a(n,e):e()};w.each(t,function(){void 0!==this&&(w.fn[this.name]||(this.js===w.AppConfigOptions.def.basepinctrl.js?o=w.AppConfigOptions.script.gispath+this.js:n.push(w.AppConfigOptions.script.gispath+this.js)))}),w.fn.jsPanel||n.push(w.AppConfigOptions.script.gispath+"/jspanel/jquery.jspanel-1.10.0.js"),window.helper&&window.helper.loaded||n.push(w.AppConfigOptions.script.gispath+"/helper.js"),window.xmlToJSON||n.push(w.AppConfigOptions.script.gispath+"/other/xmlToJSON.js"),w.colpick||(w("<link/>",{rel:"stylesheet",type:"text/css",href:w.AppConfigOptions.script.gispath+"/other/colpick.css"}).appendTo("head"),n.push(w.AppConfigOptions.script.gispath+"/other/colpick.js")),o?a([o],i):i()},w.AppConfigOptions.require.all=function(t){for(var e in w.AppConfigOptions.def.all=[],w.AppConfigOptions.def)if("all"!==e){if("boundary"==e&&window.boundary&&window.boundary.PolygonBoundary)continue;w.AppConfigOptions.def.all.push(w.AppConfigOptions.def[e])}w.AppConfigOptions.require.request(w.AppConfigOptions.def.all,t)},w.MapBaseLayerDefaultSettings={layerid:"basemaplayer",tiles:{MAP_TYPE_ROADMAP:{id:"google_roadmap",name:"街圖",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}.googleapis.com/vt?lyrs=m@262000000&src=apiv3&hl=zh-TW&x=${col}&y=${row}&z=${level}&style=47,37%7Csmartmaps",options:{subDomains:["mt0","mt1","mt2","mt3"]}},MAP_TYPE_SATELLITE_HYBRID:{id:"google_hybrid",name:"衛星",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}.google.com/vt/lyrs=y&hl=zh-TW&x=${col}&y=${row}&z=${level}&s=Galile",options:{subDomains:["mt0","mt1","mt2","mt3"]}},MAP_TYPE_PHYSICAL_HYBRID:{id:"google_terrain",name:"地形",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}.google.com.tw/vt/lbw/lyrs=p&hl=zh-TW&x=${col}&y=${row}&z=${level}&s=Gali",options:{subDomains:["khm0","khm1","khm2","khm3"]}}},ext:{TGOS:{"通用版電子地圖":{id:"tgos",name:"通用版電子地圖",type:"WebTiledLayer",url:document.location.protocol+"//wmts.nlsc.gov.tw/wmts/EMAP5/default/GoogleMapsCompatible/${level}/${row}/${col}",options:{subDomains:["","",""]}},"TGOS電子地圖":{id:"TGOSMAP_W",name:"TGOS電子地圖",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}gis.sinica.edu.tw/tgos/file-exists.php?img=TGOSMAP_W-png-${level}-${col}-${row}",options:{subDomains:["","",""]}},"福衛二號混合圖":{id:"ROADMAP_W",name:"福衛二號混合圖",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}gis.sinica.edu.tw/tgos/file-exists.php?img=ROADMAP_W-png-${level}-${col}-${row}",options:{subDomains:["","",""]}},"福衛二號影像":{id:"F2IMAGE_W",name:"福衛二號影像",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}gis.sinica.edu.tw/tgos/file-exists.php?img=F2IMAGE_W-png-${level}-${col}-${row}",options:{subDomains:["","",""]}},"地形暈渲混合圖":{id:"HILLSHADE_W",name:"地形暈渲混合圖",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}gis.sinica.edu.tw/tgos/file-exists.php?img=HILLSHADEMIX_W-png-${level}-${col}-${row}",options:{subDomains:["","",""]}},"地形暈渲圖":{id:"HILLSHADE_W",name:"地形暈渲圖",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}gis.sinica.edu.tw/tgos/file-exists.php?img=HILLSHADE_W-png-${level}-${col}-${row}",options:{subDomains:["","",""]}},"路網數值圖":{id:"MOTCMAP_W",name:"路網數值圖",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}gis.sinica.edu.tw/tgos/file-exists.php?img=MOTCMAP_W-png-${level}-${col}-${row}",options:{subDomains:["","",""]}},"航照影像":{id:"PHOTO2",name:"航照影像",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}wmts.nlsc.gov.tw/wmts/PHOTO2/default/GoogleMapsCompatible/${level}/${row}/${col}",options:{subDomains:["","",""]}}},Google:{silver:{id:"sliver-street",name:"銀白",type:"WebTiledLayer",url:document.location.protocol+"//maps.googleapis.com/maps/vt?pb=!1m5!1m4!1i${level}!2i${col}!3i${row}!4i256!2m3!1e0!2sm!3i553276236!3m17!2szh-TW!3sUS!5e18!12m4!1e68!2m2!1sset!2sRoadmap!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy5lOmd8cC5jOiNmZmY1ZjVmNSxzLmU6bC5pfHAudjpvZmYscy5lOmwudC5mfHAuYzojZmY2MTYxNjEscy5lOmwudC5zfHAuYzojZmZmNWY1ZjUscy50OjIxfHMuZTpsLnQuZnxwLmM6I2ZmYmRiZGJkLHMudDoyfHMuZTpnfHAuYzojZmZlZWVlZWUscy50OjJ8cy5lOmwudC5mfHAuYzojZmY3NTc1NzUscy50OjQwfHMuZTpnfHAuYzojZmZlNWU1ZTUscy50OjQwfHMuZTpsLnQuZnxwLmM6I2ZmOWU5ZTllLHMudDozfHMuZTpnfHAuYzojZmZmZmZmZmYscy50OjUwfHMuZTpsLnQuZnxwLmM6I2ZmNzU3NTc1LHMudDo0OXxzLmU6Z3xwLmM6I2ZmZGFkYWRhLHMudDo0OXxzLmU6bC50LmZ8cC5jOiNmZjYxNjE2MSxzLnQ6NTF8cy5lOmwudC5mfHAuYzojZmY5ZTllOWUscy50OjY1fHMuZTpnfHAuYzojZmZlNWU1ZTUscy50OjY2fHMuZTpnfHAuYzojZmZlZWVlZWUscy50OjZ8cy5lOmd8cC5jOiNmZmM5YzljOSxzLnQ6NnxzLmU6bC50LmZ8cC5jOiNmZjllOWU5ZQ!4e0!5m1!5f2",options:{subDomains:["","","",""]}},gray:{id:"ggray-street",name:"灰階",type:"WebTiledLayer",url:document.location.protocol+"//maps.googleapis.com/maps/vt?pb=!1m5!1m4!1i${level}!2i${col}!3i${row}!4i256!2m3!1e0!2sm!3i432136532!3m14!2szh-TW!3sUS!5e18!12m1!1e68!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2sp.s%3A-100!4e0!23i1301875",options:{subDomains:["","","",""]}},retro:{id:"retro-street",name:"復古",type:"WebTiledLayer",url:document.location.protocol+"//maps.googleapis.com/maps/vt?pb=!1m5!1m4!1i${level}!2i${col}!3i${row}!4i256!2m3!1e0!2sm!3i553276248!3m17!2szh-TW!3sUS!5e18!12m4!1e68!2m2!1sset!2sRoadmap!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy5lOmd8cC5jOiNmZmViZTNjZCxzLmU6bC50LmZ8cC5jOiNmZjUyMzczNSxzLmU6bC50LnN8cC5jOiNmZmY1ZjFlNixzLnQ6MXxzLmU6Zy5zfHAuYzojZmZjOWIyYTYscy50OjIxfHMuZTpnLnN8cC5jOiNmZmRjZDJiZSxzLnQ6MjF8cy5lOmwudC5mfHAuYzojZmZhZTllOTAscy50OjgyfHMuZTpnfHAuYzojZmZkZmQyYWUscy50OjJ8cy5lOmd8cC5jOiNmZmRmZDJhZSxzLnQ6MnxzLmU6bC50LmZ8cC5jOiNmZjkzODE3YyxzLnQ6NDB8cy5lOmcuZnxwLmM6I2ZmYTViMDc2LHMudDo0MHxzLmU6bC50LmZ8cC5jOiNmZjQ0NzUzMCxzLnQ6M3xzLmU6Z3xwLmM6I2ZmZjVmMWU2LHMudDo1MHxzLmU6Z3xwLmM6I2ZmZmRmY2Y4LHMudDo0OXxzLmU6Z3xwLmM6I2ZmZjhjOTY3LHMudDo0OXxzLmU6Zy5zfHAuYzojZmZlOWJjNjIscy50Ojc4NXxzLmU6Z3xwLmM6I2ZmZTk4ZDU4LHMudDo3ODV8cy5lOmcuc3xwLmM6I2ZmZGI4NTU1LHMudDo1MXxzLmU6bC50LmZ8cC5jOiNmZjgwNmI2MyxzLnQ6NjV8cy5lOmd8cC5jOiNmZmRmZDJhZSxzLnQ6NjV8cy5lOmwudC5mfHAuYzojZmY4ZjdkNzcscy50OjY1fHMuZTpsLnQuc3xwLmM6I2ZmZWJlM2NkLHMudDo2NnxzLmU6Z3xwLmM6I2ZmZGZkMmFlLHMudDo2fHMuZTpnLmZ8cC5jOiNmZmI5ZDNjMixzLnQ6NnxzLmU6bC50LmZ8cC5jOiNmZjkyOTk4ZA!4e0!5m1!5f2",options:{subDomains:["","","",""]}},dark:{id:"gdark-street",name:"黑階",type:"WebTiledLayer",url:document.location.protocol+"//maps.googleapis.com/maps/vt?pb=!1m5!1m4!1i${level}!2i${col}!3i${row}!4i256!2m3!1e0!2sm!3i480190100!3m14!2szh-TW!3sUS!5e18!12m1!1e68!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy5lOmd8cC5jOiNmZjI0MmYzZSxzLmU6bC50LnN8cC5jOiNmZjI0MmYzZSxzLmU6bC50LmZ8cC5jOiNmZjc0Njg1NSxzLnQ6MTl8cy5lOmwudC5mfHAuYzojZmZkNTk1NjMscy50OjJ8cy5lOmwudC5mfHAuYzojZmZkNTk1NjMscy50OjQwfHMuZTpnfHAuYzojZmYyNjNjM2Yscy50OjQwfHMuZTpsLnQuZnxwLmM6I2ZmNmI5YTc2LHMudDozfHMuZTpnfHAuYzojZmYzODQxNGUscy50OjN8cy5lOmcuc3xwLmM6I2ZmMjEyYTM3LHMudDozfHMuZTpsLnQuZnxwLmM6I2ZmOWNhNWIzLHMudDo0OXxzLmU6Z3xwLmM6I2ZmNzQ2ODU1LHMudDo0OXxzLmU6Zy5zfHAuYzojZmYxZjI4MzUscy50OjQ5fHMuZTpsLnQuZnxwLmM6I2ZmZjNkMTljLHMudDo0fHMuZTpnfHAuYzojZmYyZjM5NDgscy50OjY2fHMuZTpsLnQuZnxwLmM6I2ZmZDU5NTYzLHMudDo2fHMuZTpnfHAuYzojZmYxNzI2M2Mscy50OjZ8cy5lOmwudC5mfHAuYzojZmY1MTVjNmQscy50OjZ8cy5lOmwudC5zfHAuYzojZmYxNzI2M2M!4e0!5m1!5f2",options:{subDomains:["","","",""]}},night_mode:{id:"night-mode-street",name:"夜晚",type:"WebTiledLayer",url:document.location.protocol+"//maps.googleapis.com/maps/vt?pb=!1m5!1m4!1i${level}!2i${col}!3i${row}!4i256!2m3!1e0!2sm!3i553276212!3m17!2szh-TW!3sUS!5e18!12m4!1e68!2m2!1sset!2sRoadmap!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy5lOmd8cC5jOiNmZjI0MmYzZSxzLmU6bC50LnN8cC5jOiNmZjI0MmYzZSxzLmU6bC50LmZ8cC5jOiNmZjc0Njg1NSxzLnQ6MTl8cy5lOmwudC5mfHAuYzojZmZkNTk1NjMscy50OjJ8cy5lOmwudC5mfHAuYzojZmZkNTk1NjMscy50OjQwfHMuZTpnfHAuYzojZmYyNjNjM2Yscy50OjQwfHMuZTpsLnQuZnxwLmM6I2ZmNmI5YTc2LHMudDozfHMuZTpnfHAuYzojZmYzODQxNGUscy50OjN8cy5lOmcuc3xwLmM6I2ZmMjEyYTM3LHMudDozfHMuZTpsLnQuZnxwLmM6I2ZmOWNhNWIzLHMudDo0OXxzLmU6Z3xwLmM6I2ZmNzQ2ODU1LHMudDo0OXxzLmU6Zy5zfHAuYzojZmYxZjI4MzUscy50OjQ5fHMuZTpsLnQuZnxwLmM6I2ZmZjNkMTljLHMudDo0fHMuZTpnfHAuYzojZmYyZjM5NDgscy50OjY2fHMuZTpsLnQuZnxwLmM6I2ZmZDU5NTYzLHMudDo2fHMuZTpnfHAuYzojZmYxNzI2M2Mscy50OjZ8cy5lOmwudC5mfHAuYzojZmY1MTVjNmQscy50OjZ8cy5lOmwudC5zfHAuYzojZmYxNzI2M2M!4e0!5m1!5f2",options:{subDomains:["","","",""]}},hide_featires:{id:"hide-featires-street",name:"精簡街景",type:"WebTiledLayer",url:document.location.protocol+"//maps.googleapis.com/maps/vt?pb=!1m5!1m4!1i${level}!2i${col}!3i${row}!4i256!2m3!1e0!2sm!3i553276236!3m17!2szh-TW!3sUS!5e18!12m4!1e68!2m2!1sset!2sRoadmap!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHAudjpvZmYscy50OjR8cy5lOmwuaXxwLnY6b2Zm!4e0!5m1!5f2",options:{subDomains:["","","",""]}},g3d:{id:"g3d",name:"3D",type:"WebTiledLayer",url:"https://${subDomain}.googleapis.com/kh?v=134&hl=zh-TW&deg=0&x=${col}&y=${row}&z=${level}",options:{subDomains:["khms0"]}}}},defaultSettings:{map:null,ctrlMode:"radio",defaultLayer:"街圖",initEvent:null}},w.menuctrl={eventKeys:{popu_init_before:"popu-init-event-before",popu_init_after:"popu-init-event-after",ctrl_show_change:"showchange",init_ctrl_menu_completed:"init-menu-init_ctrl_menu_completed"}},w.checkFunctionMenu=function(t,o){if(o&&"*"!=o){var e=w(t+" [data-function-id]");w.each(e,function(){var t=w(this),e=t.attr("data-function-id");t.addClass("none-auth-function"),w.each(o,function(){if(e==this.Id)return t.removeClass("none-auth-function"),!1})}),w(t+" .none-auth-function").remove(),w.each(w(t+" ul:not(:has(*))"),function(){0<w(this).parent("li").length&&w(this).parent("li").remove()})}},w.initGisMenu=function(t){window.helper?e(t):loadRequestScript(function(){e(t)})};var e=function(t){try{w("body").addClass("bootstrp-version-"+helper.bootstrap.getversion())}catch(t){}var p=w(".popu-ctrl-container"),c=0===t.indexOf(".")?w(t):w("#"+t),d=0==c.height()?0:c.outerHeight?c.outerHeight():c.height();w("body")[0].style.setProperty("--mainmenu-height",d+"px"),w.each(w(".popu-ctrl-menu"),function(){p.find(w(this).attr("href")).addClass("popu-ctrl-content")});var e;e=w(".tools-group-ctrl",c),w.each(e,function(){var t=w(this).removeClass("dropdown-toggle");t.find(".caret:first").remove();var e=w(".popu-ctrl-container"),o=w("+ul",t);o.addClass("tools-group-panel"),o.removeClass("dropdown-menu"),o.appendTo(e),o.attr("id")||o.attr("id","id"+helper.misc.geguid().replace(/-/g,"")),t.attr("href","#"+o.attr("id")).addClass("posit-ctrl-menu"),w.each(w(">li>a",o),function(){var t=w(this);t.addClass("tools-member-ctrl"),t.attr("title",t.html()),t.html(""),w('<span class="glyphicon '+t.attr("data-glyphicon")+'"></span>').appendTo(t)})});w(".popu-ctrl-menu").on("click",function(t){var e=w(this);t.preventDefault(),w(".navbar-collapse",c).removeClass("in").addClass("collapse"),c.find(".collapse.show").removeClass("show");var o=w(w(this).attr("href"));if(o.show(),t.clientX&&h(e,{clientX:t.clientX,clientY:t.clientY}),0<o.length&&null==w(this).attr("popu-target")){o.show(),o.trigger(w.menuctrl.eventKeys.popu_init_before);var n=(new Date).getTime();o.css("min-height","100%");var i=e.attr("data-theme")?e.attr("data-theme"):"gdark",a=p.hasClass("fixed-at-left fixed-single")?-480:t.clientX,s=w(".popu-ctrl-container").jsPanel({id:n+"",classes:e.hasClass("tools-member-ctrl")?"jsPanel-window":"",title:this.innerHTML+(w(this).hasClass("tools-member-ctrl")?" "+w(this).attr("title"):""),theme:i,contentBG:{padding:"0 3px 3px 3px"},size:{width:"",height:"auto"},overflow:"auto",draggable:{stop:function(t,e){w(t.target).css("opacity","")},handle:".jsPanel-hdr"},position:w.isSupportLocalStorage()?{top:t.clientY,left:a}:{top:d,left:g()?15*w(".popu-ctrl-container .jsPanel").length:""},controls:{buttons:"all",iconfont:"bootstrap"},content:o}).addClass("popu-ctrl").on("onjspanelloaded",function(t,e){s.position().left<0&&s.css("left",0),s.position().top<0&&s.css("top",0)});o.attr("id")&&s.addClass("jsPanel-"+o.attr("id")),s.on("resizestart",function(t){window.jspanel_resize_drag=!0}),s.on("resizestop",function(){h(e,{width:s.width(),height:s.height()}),window.jspanel_resize_drag=!1}),s.on("dragstart",function(t){window.jspanel_resize_drag=!0}),s.on("dragstop",function(){s.attr("data-top",s.position().top),s.attr("data-left",s.position().left),h(e,{top:s.position().top,left:s.position().left}),window.jspanel_resize_drag=!1}),w(this).attr("data-default-width")&&s.attr("data-width",w(this).attr("data-default-width")),w(this).attr("data-default-height")&&s.attr("data-height",w(this).attr("data-default-height")),w(this).attr("data-default-top")&&s.attr("data-top",w(this).attr("data-default-top")),w(this).attr("data-default-left")&&s.attr("data-left",w(this).attr("data-default-left")),w(this).attr("popu-target",n),w(".jsPanel-content",s).css("padding","0 2px 2px 2px"),w(".jsPanel-hdr-r .jsPanel-hdr-r-btn-close",s).unbind("click").on("click",function(){l(e,s)}),w(".jsPanel-hdr-r-btn-max",s).hide(),w(".jsPanel-hdr-r-btn-min",s).hide(),w(".jsPanel-hdr-r-btn-max",s).on("click",function(){w(".jsPanel-hdr-r-btn-max",s).hide(),w(".jsPanel-hdr-r-btn-min",s).show(),w(".jsPanel-hdr-r .jsPanel-hdr-r-btn-close",s).show()}),s.mouseenter(function(){s.front()}),f(),o.trigger(w.menuctrl.eventKeys.popu_init_after),s.hide()}0;var r=w("#"+w(this).attr("popu-target"));l(e,r)}).on("setActive",function(t,e){var o=w(t.target);e&&!o.hasClass("selected")?o.trigger("click"):!e&&o.hasClass("selected")&&o.trigger("click")}),w(".posit-ctrl-menu").on("click",function(t){var e=w(this),o=e.attr("data-cache-show");t.preventDefault(),w(".navbar-collapse",c).removeClass("in").addClass("collapse"),c.find(".collapse.show").removeClass("show");var n=w(w(this).attr("href"));0<n.length&&null==w(this).attr("popu-target")&&(n.trigger(w.menuctrl.eventKeys.popu_init_before),n.hide(),w(this).attr("popu-target",(new Date).getTime()),n.trigger(w.menuctrl.eventKeys.popu_init_after));var i=n.attr("data-display-direction")||e.attr("data-display-direction");"false"!=o&&h(e,{show:!n.is(":visible")});var a=function(){n.is(":visible")?n.addClass("selected"):n.removeClass("selected")};"up-down"===i?n.is(":hidden")?n.slideDown(500,a):n.slideUp(500,a):n.toggle("slide",{direction:i||"left",easing:"easeInOutBack"},500,a),n.mouseenter(function(){var t=0;w(".jsPanel").each(function(){w(this).zIndex()>t&&(t=w(this).zIndex())}),n.css("z-index",t+1)}),e.toggleClass("selected"),e.trigger(w.menuctrl.eventKeys.ctrl_show_change,e.hasClass("selected"))}).on("setActive",function(t,e){var o=w(t.target);e&&!o.hasClass("selected")?o.trigger("click"):!e&&o.hasClass("selected")&&o.trigger("click")});w('<div class="close-mainmenu"><span title="隱藏" class=" glyphicon glyphicon-export"></span></div>').prependTo(w(".navbar-collapse",c));w(".glyphicon.glyphicon-export",c);w(".close-mainmenu",c).on("click",function(){c.toggle("slide",{direction:"top",easing:"easeInOutCubic"},500)}),c.after('<div style="right:0px;position: absolute;top:0;z-index:'+(("auto"==c.css("z-index")?950:c.css("z-index"))-1)+';"><button  class=" show-mainmenu" ><span title="功能選單" class="glyphicon glyphicon-align-justify"></span></button></div>'),w(".show-mainmenu").on("click",function(){c.toggle("slide",{direction:"top",easing:"easeInOutBack"},500)});var m=function(e,o){var n="ctrl-transition-ing "+(g()?"switch":"popu-slide");o.addClass(n),o.one("transitionend oTransitionEnd otransitionend MSTransitionEnd",function(t){clearTimeout(i),setTimeout(function(){o.removeClass(n),e.hasClass("selected")||o.hide()},10)});var i=setTimeout(function(){o.removeClass(n),e.hasClass("selected")||o.hide()},650)},u=0,l=function(t,e){t.toggleClass("selected");var o=t.hasClass("selected"),n=t.attr("data-cache-show"),i=g(),a="ctrl-transition-ing "+(i?"switch":"popu-slide");if(e.show().addClass(a),setTimeout(function(){e.toggleClass("selected"),m(t,e),"false"!=n&&h(t,{show:o}),t.trigger(w.menuctrl.eventKeys.ctrl_show_change,o)}),i&&w.isSupportLocalStorage())if(0==e.parents("#jsPanel-min-container").length){e.position();var s=y(t);if(o){var r=s&&s.top||e.attr("data-top")||(c.is(":visible")?d:10),l=s&&s.left||e.attr("data-left")||40*u++;e.css("top",r+"px"),e.css("left",l+"px")}else s&&s.clientY&&e.css("top",s.clientY+"px"),s&&s.clientX&&e.css("left",s.clientX+"px")}else w(".jsPanel-hdr-r-btn-max",e).trigger("click")};w(".posit-ctrl-menu,.popu-ctrl-menu").on(w.menuctrl.eventKeys.ctrl_show_change,function(t,e){n.call(this,t,e)});var o,n=function(t,e){var o=w(this);if(o.attr("trigger-show-group-form-other"))setTimeout(function(){o.removeAttr("trigger-show-group-form-other")});else{var n=o.attr("data-show-group-all");n&&c.find('[data-show-group-all="'+n+'"]:not([href="'+o.attr("href")+'"])').attr("trigger-show-group-form-other",!0).trigger("setActive",[e]);var i=o.attr("data-show-group-single");i&&c.find('.selected[data-show-group-single="'+i+'"]:not([href="'+o.attr("href")+'"])').attr("trigger-show-group-form-other",!0).trigger("setActive",[!1])}},f=function(){var a=w(".popu-ctrl-container").removeClass("width_100"),t=w(".popu-ctrl-container .popu-ctrl");w(".popu-ctrl-container.fixed-at-left").length;if(0<t.length)if(g())w.each(t,function(t,e){var o=w(e);if(o.css("position","absolute"),o.attr("data-width")&&""!=o.attr("data-width").trim()&&(o.css("width",w(e).attr("data-width")),w(e).attr("data-width","")),o.attr("data-height")&&(o.css("height",w(e).attr("data-height")),w(e).attr("data-height","")),void 0!==o.attr("data-top")){var n=w(e).attr("data-top").replace("px",""),i=w(e).attr("data-left").replace("px",""),a=w(window).height(),s=w(window).width();a-n<70&&(n=a-70),s-i<200&&(i=s-200),o.css("top",n+"px"),o.css("left",i+"px")}w("").draggable&&o.hasClass("horizontal-drag-remove")&&o.draggable("option","axis",!1).off("drag").off("dragstop").removeClass("horizontal-drag-remove")});else{var o=d;w.each(t,function(t,e){var n,i=w(e);"relative"!=i.css("position")&&(i.attr("data-top",w(e).css("top")),i.attr("data-left",w(e).css("left")),!i.hasClass("fix-popu-ctrl-toleft")&&0<=(i.attr("style")+"").indexOf("width:")&&(i.attr("data-width",w(e).css("width")),i.css("width","auto")),i.css("top",o),i.css("left","0px"),i.css("position","relative"),w("").draggable&&i.draggable("option","axis","x"),i.addClass("horizontal-drag-remove"),i.off("dragstart").on("dragstart",function(){n=Date.now(),a.addClass("width_100")}).off("drag").on("drag",function(t){if(0<i.position().left)return!1}).off("dragstop").on("dragstop",function(){var t=i.width(),e=i.position().left,o=Date.now()-n;Math.abs(e/t)>(o<360?.1:.25)?(i.find(">.jsPanel-hdr > .jsPanel-hdr-r > .jsPanel-hdr-r-btn-close").trigger("click"),setTimeout(function(){a.removeClass("width_100"),i.css("left","0px")},600)):(i.css("left","0px"),a.removeClass("width_100"))}))})}};try{o={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return o.Android()||o.BlackBerry()||o.iOS()||o.Opera()||o.Windows()}}}catch(t){}var g=function(){return!!o&&!o.any()},s=g();w(window).resize(function(){setTimeout(function(){var t=g();s==t&&window.jspanel_resize_drag||f(),s=t},50)});var h=function(t,e){w.localCache.set(t.text()?t.text():t.attr("title"),w.extend(y(t),e))},y=function(t){return w.localCache.get(t.text()?t.text():t.attr("title"))};return setTimeout(function(){!function(){if(p.hasClass("fixed-at-left")){var i=p.hasClass("fixed-single");c.find(".popu-ctrl-menu").each(function(){var n=w(this).on(w.menuctrl.eventKeys.ctrl_show_change,function(t,e){var o=w("#"+w(this).attr("popu-target"));w(this).attr("popu-target"),i?(e?o.addClass("fixed-show"):o.removeClass("fixed-show"),e?p.addClass("has-fixed-show"):p.removeClass("has-fixed-show"),o.width(),s&&o[0].style.setProperty("--adj-width",-o.width()+"px")):(o.prependTo(p),e&&p.animate({scrollTop:0},500),p.attr("data-fixed-count",p.find(".popu-ctrl.selected:not(.jsPanel-window)").length))});w(n.attr("href")).on(w.menuctrl.eventKeys.popu_init_after,function(){var t=w(this),e=t.parents(".popu-ctrl").addClass("fix-popu-ctrl-toleft");if(w('<div class="jsPanel-hdr-r-btn-content"><span class="glyphicon glyphicon-play"></span></div>').appendTo(t.parents(".popu-ctrl").find(".jsPanel-hdr-r")).find(".glyphicon").on("click",function(){e.find(".jsPanel-content").toggleClass("offdisplay"),w(this).parent().toggleClass("ctrl-content-display")}),w('<div class="jsPanel-hdr-r-btn-modal"><span class="glyphicon glyphicon-modal-window"></span></div>').appendTo(t.parents(".popu-ctrl").find(".jsPanel-hdr-r")).find(".glyphicon").on("click",function(){w(this).toggleClass("glyphicon-modal-window"),w(this).toggleClass("glyphicon-pushpin"),e.toggleClass("jsPanel-window"),e[0].style.left=p.width()+6+"px",e[0].style.top=d+"px",p.attr("data-fixed-count",p.find(".popu-ctrl.selected:not(.jsPanel-window)").length)}),i){n.attr("data-show-group-single","fixed-left-single"),w('<div class="jsPanel-hdr-r-btn-collapse"><span class="glyphicon glyphicon-chevron-right to-show"></span><span class="glyphicon glyphicon-chevron-left to-collapse"></span></div>').appendTo(t.parents(".popu-ctrl").find(".jsPanel-hdr-r")).on("click",function(){e.toggleClass("fixed-show"),p.toggleClass("has-fixed-show"),e.show(),m(n,e)});var o=getComputedStyle(e.find("> .jsPanel-hdr")[0]);"transparent"!=o.backgroundColor&&"rgba(0, 0, 0, 0)"!=o.backgroundColor||(e.find("> .jsPanel-hdr")[0].style.backgroundColor="white"),helper.misc.detect.isIE||(w('<div class="resizer"><div class="size-icon"></div></div>').appendTo(e),a(e))}e.width(""),e.attr("data-width","")}),i&&n.attr("data-show-group-single","fixed-left-single")}),w(".posit-ctrl-menu").each(function(){var t=w(w(this).attr("href"));t.parent().hasClass("fixed-at-left")&&(t.css("position","fixed"),(0<=window.navigator.userAgent.indexOf("MSIE ")||0<=window.navigator.userAgent.indexOf("Trident/"))&&t.css("overflow","hidden"))}),i||(w('<div class="resizer"><div class="size-icon"></div></div>').appendTo(p),a(p))}function a(o){for(var t,n,i=o.hasClass("jsPanel")?30:0,a=o[0],e=o.find(".resizer"),s=0;s<e.length;s++)e[s].addEventListener("mousedown",function(t){null!=t.button&&2==t.button||(t.preventDefault(),window.addEventListener("mousemove",r),window.addEventListener("mouseup",l))});function r(e){clearTimeout(t),"none"!=a.style.maxWidth&&(a.style.maxWidth="none"),t=setTimeout(function(){var t=e.pageX-a.getBoundingClientRect().left+i;a.style.setProperty("width",t+"px"),a.style.setProperty("--adj-width",-(t-i)+"px"),p[0].style.setProperty("--adj-popu-width",-(t-i)+"px"),clearTimeout(n),n=setTimeout(function(){o.hasClass("jsPanel")&&o.trigger("resizestop"),o.find(".jsPanel").trigger("resizestop")},100)},20)}function l(){window.removeEventListener("mousemove",r)}}}(),"true"===c.attr("data-ctrl-cache")&&w.each(w(".popu-ctrl-menu,.posit-ctrl-menu "),function(){var t=y(w(this));if(t)for(var e in t)void 0!==t[e]&&w(this).attr("data-default-"+e,t[e])});try{w(".popu-ctrl-menu[data-default-show=true],.posit-ctrl-menu[data-default-show=true]",c).trigger("setActive",[!0]).blur(),w(".tools-group-panel .popu-ctrl-menu[data-default-show=true],.tools-group-panel .posit-ctrl-menu[data-default-show=true]").trigger("setActive",[!0]).blur()}catch(t){console.log(t)}c.trigger(w.menuctrl.eventKeys.init_ctrl_menu_completed)},800),this};w.kmlhelper=function(o){var n={autoPolygonIndextoLower:!0,onLoaded:void 0};w.extend(n,o),null!=n.map&&require(["esri/layers/KMLLayer"],function(t){var e=new t(encodeURI(o.kmlurl),{id:n.layerid});n.map.addLayer(e),!0===n.autoPolygonIndextoLower?w.setPolygonIndextoLower(n.map,e,n.onLoaded):n.onLoaded&&e.on("load",function(t){n.onLoaded&&n.onLoaded(e)})})},w.parserStringToObject=function(t,e,n){var i={};return t&&w.each(t.split(e),function(t,e){if(e&&e.trim()){var o=e.split(n);0!=o.length&&(1==o.length?i[o[0].trim()]=o[0].trim():i[o[0].trim()]=o[1].trim())}}),i};var l=0;w.setPolygonIndextoLower=function(a,s,r){require(["dojo/_base/connect","esri/symbols/SimpleMarkerSymbol"],function(t,e){var o=s.__proto__?s.__proto__.declaredClass:s.declaredClass;if("esri.layers.KMLLayer"===o)s.on("load",function(t){var o=t.layer.getLayers(),n=0;w.each(o,function(t,e){w.setPolygonIndextoLower(a,e,function(){++n===o.length&&r&&r(s)})})}),s.on("error",function(t){r(s,t,"error")});else if("esri.layers.FeatureLayer"===o){var n=w.parseJSON(s._json);if(0<n.featureSet.features.length)if(Boolean(n.featureSet.features[0].attributes.visibility))var i=t.connect(s,"onUpdate",function(){t.disconnect(i),0<s.graphics.length&&"polygon"===s.graphics[0].geometry.type&&(a.reorderLayer(s,l),l++),r&&r(s),console.log(s.id+">>onload>")});else r&&r(s);else r&&r(s)}else"esri.layers.MapImageLayer"===o&&r&&r(s)})},w.loadKmllayer=function(o,t,n,i,a,s){var r=null,l=t;try{if(localStorage&&i){var e=JSON.parse(localStorage.getItem(l));e&&(e.version==a?r=e.data:(localStorage.removeItem(l),console.log(n+" reomve old localStorage ;old version:"+e.version+"  new version:"+a)))}localStorage&&!i&&(localStorage.removeItem(l),console.log(n+" not use localStorage ;"))}catch(t){}r?(require(["esri/layers/FeatureLayer"],function(t){var e=new t(r,{id:n+"_0"});o.addLayer(e),s(e)}),console.log(n+" use localStorage ;version:"+a)):(w.kmlhelper({map:o,layerid:n,kmlurl:t,onLoaded:function(t){var e=t.getLayers()[0];if(!dojo.isAndroid&&!dojo.isIos&&localStorage&&i&&e.toJson)try{var o=e.toJson();localStorage.setItem(l,JSON.stringify({version:a,"data-size":JSON.stringify(o).length,data:o}))}catch(t){console.log(t)}s(e)}}),console.log(n+" use kml"))},w.autoOrderLayer=function(e){var o=0,n=0,i=0,a=function(t){0<="point|multipoint ".indexOf(t.graphics[0].geometry.type)?function(t){e.reorderLayer(t,i),i++}(t):0<="polyline".indexOf(t.graphics[0].geometry.type)?function(t){e.reorderLayer(t,n),n++,i++}(t):0<="polygon|extent".indexOf(t.graphics[0].geometry.type)&&function(t){e.reorderLayer(t,o),o++,n++,i++}(t)};e.on("layer-add",function(e){if(e.layer.graphics)if(0<e.layer.graphics.length)a(e.layer);else var o=e.layer.on("graphic-add",function(t){a(e.layer),o.remove()})})};w.fn.gis_layer_opacity_slider=function(t){var e,o={map:null,layerid:void 0,min:10,max:100,value:95},n=!1;if(w.extend(o,t),null==o.map&&alert("map is null"),e=helper.browser.support.inputRange()?w('<input type="range" class="range-ctrl" min="'+o.min+'" max="'+o.max+'" value="'+o.value+'">').on("input",function(){i(parseInt(this.value))}).css("padding-left",0).appendTo(this):this.slider({range:"min",max:o.max,min:o.min,value:o.value,slide:i,change:i}),"arcgis"===whatMap(o.map))if(o.map._layers[o.layerid])n=!0;else o.map.on("layer-add",function(t){t.layer.id==o.layerid&&(n=!0,i())});function i(t){w.isNumeric(t)||(t=e.val()||e.slider("value")),o.setOpacity&&o.setOpacity(t/100),n&&o.map.getLayer(o.layerid).setOpacity(t/100)}return i(o.value),this}}(jQuery),function(){for(var a=0,t=["ms","moz","webkit","o"],e=0;e<t.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[t[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[e]+"CancelAnimationFrame"]||window[t[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var o=(new Date).getTime(),n=Math.max(0,16-(o-a)),i=window.setTimeout(function(){t(o+n)},n);return a=o+n,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}()