$.AppConfigOptions&&$.AppConfigOptions.script&&$.AppConfigOptions.script.gispath||alert("尚未設定(BasePinCtrl)$.AppConfigOptions.script.gispath"),function(o){"use strict";o.BasePinCtrl={defaultSettings:{id:void 0,name:"XXXX",stTitle:function(t){return"XXXX"},map:void 0,useLabel:!0,pinLabel:!0,useList:!0,useExport:void 0,listContainer:".popu-ctrl-container",listTheme:"meter",listOptions:{},useCardview:!0,defalutCardview:!1,useSearch:!0,enabledStatusFilter:!1,minZoom:0,maxZoom:19,classes:void 0,clickable:!0,pinClick:void 0,autoReload:{auto:!1,interval:3e5},pinsize:{x:12,y:12,minx:8,maxx:32,miny:10,maxy:32,step:4,anchor:"cneter"},geometryOtherOptions:{},dynPinsize:!0,legendIcons:[],infoFields:[],layerid:void 0,pinInfoLabelMinWidth:void 0,boundary:void 0,filter:void 0,infoWindowAnimation:!0,useInfoWindow:!0,canFullInfowindow:!1,singleInfoWindow:!0,cluster:!1,clusterRadius:80,clusterDisableAtZoom:19,pinInfoContent:function(s){var n=this.settings,t=n.infoFields,a="";return a="<table>",o.each(t,function(t,e){if("geojson"!=e.field)try{var i=e.showInInfo;"function"==typeof i&&(i=i.call(this,s)),!1!==i&&(a+="<tr><td "+(n.pinInfoLabelMinWidth?'style="min-width: '+n.pinInfoLabelMinWidth+';"':"")+"><span  ><b>"+e.title+"</b></span></td><td><span>"+(e.formatter?e.formatter(s[e.field.trim()],s,"InfoWindow"):s[e.field])+(e.unit?" "+e.unit:"")+"</span></td></tr>")}catch(t){console.log(e.title+"pinInfoContent錯誤:"+t)}}),a+="</table>",'<div class="meterInfoTemplateContent rete-info-content '+this.settings.name+'-info-content">'+a+"</div>"},checkDataStatus:function(t,e){return{classes:"blue_status"}},baseInfoMerge:{basekey:void 0,infokey:void 0,xfield:void 0,yfield:void 0,aftermerge:function(t){}},transformData:function(t,s){var e,n=this;if(this.baseInfoMerge&&(this.baseInfoMerge.basekey||this.baseInfoMerge.basekey||this.baseInfoMerge.xfield)){var i,a=this.baseInfoMerge,l=!0;t&&0<t.length?i=JSON.parse(JSON.stringify(t)):(i=JSON.parse(JSON.stringify(s)),l=!1),o.each(i,function(){var t=this;if(l){var e=this[a.basekey];if(s){var i=o.grep(s,function(t){return e==t[a.infokey]});0<i.length&&o.extend(t,i[0])}}a.xfield&&(t.X=helper.misc.getValueByPath(t,a.xfield)),a.yfield&&(t.Y=helper.misc.getValueByPath(t,a.yfield)),a.aftermerge&&a.aftermerge.call(n,t)}),e=i}else e=t&&0<t.length?t:s;return o.each(e,function(t,e){null==e.X&&(e.X=e.X||e.lon||e.lng||e.Lon||e.Lng||e.longitude||e.Longitude),null==e.Y&&(e.Y=e.Y||e.lat||e.Lat||e.latitude||e.Latitude)}),e},appendCustomToolbarHeader:void 0,type:"point"},eventKeys:{displayLayer:"~~displayLayer",displayList:"~~displayList",initLayer:"~~initLayer",initUICompleted:"~initUiCompleted",afterSetdata:"~afterSetdata~",repaintPinCompleted:"~repaintPinCompleted",pinShowChange:"~pinshowchange",fullInfowindowChange:"~fullInfowindowChange"},type:{point:"point",polygon:"polygon",polyline:"polyline",feature:'"Feature"'},helper:{getDataStatusLegendIcon:function(t,e){var i=void 0;return e&&(o.each(t,function(){if(this.name.trim()===e.trim())return i=this,!1}),i||console.log('無對應圖例name:"'+e+'"')),i},ajaxDotnetWebserviceEmptyParas:function(t,e){var i=this;o.BasePinCtrl.helper.ajaxGeneralRequest.call(this,{url:t,dataType:"json",contentType:"application/json; charset=utf-8",type:"POST"},function(t){e.call(i,t.d)})},ajaxDotnetWebserviceWithParasAsync:function(t,e){var i,s="string"==typeof e?e:JSON.stringify(e);return o.ajax({url:t,dataType:"json",contentType:"application/json; charset=utf-8",type:"POST",data:s,async:!1}).done(function(t,e){t&&t.d&&(i=t.d)}).fail(function(t,e){console.log(t.responseText)}),i},ajaxDotnetWebserviceWithParas:function(t,e,i){var s,n="string"==typeof e?e:JSON.stringify(e);o.ajax({url:t,dataType:"json",contentType:"application/json; charset=utf-8",type:"POST",data:n}).done(function(t,e){t&&t.d&&(s=t.d),i(s,e)}).fail(function(t,e){console.log(t.responseText),i(t,e)})},ajaxGeneralRequest:function(t,i){var s=this;o.ajax(t).done(function(t,e){i&&i.call(s,t)}).fail(function(t,e){console.log(t),i&&i.call(s,void 0)})},getWraMeterData:function(t,e,a,l,i){o.ajax({url:(window.WraMeterSource?window.WraMeterSource:"https://fhy.wra.gov.tw/Typh_New/Meter.asmx/")+t,dataType:"text",dataFilter:function(t,e){t=t.replace(/\r\n/g,"");var i=helper.format.xmlToJson.parseString(t);if(a)for(var s=a.split("."),n=0;n<s.length;n++)i=i[s[n].trim()];return i?(i=o.isArray(i)?i:[i],i=helper.format.xmlToJson.setXmlObjTextToValue(i,l)):[]},data:e,type:"POST"}).done(function(t,e){i(t)}).fail(function(t,e){console.log(JSON.stringify(t)+"<br>"+JSON.stringify(e))})},getWraFhyApi:function(t,e,i){var s=o.extend({url:"https://fhy.wra.gov.tw/Api/v2/"+t,type:"GET",headers:{apikey:"XEzkLbaHalfdYuaV0ahvzhbWeqsmkGlg"}},e);o.ajax(s).done(function(t,e){i(t)}).fail(function(t,e){i(t,e)})},getField:function(t,e){return o.grep(t,function(t){return t.field==e})[0]},reload:function(t){this.$element.show_busyIndicator({timeout:4e4}),this.__baseData||(void 0===this.settings.loadBase?console.log(this.settings.name+" 無設定取基本資料"):"string"==typeof this.settings.loadBase?o.BasePinCtrl.helper.ajaxDotnetWebserviceEmptyParas.call(this,this.settings.loadBase,this.__loadBaseCompleted):"function"==typeof this.settings.loadBase?this.settings.loadBase.call(this,jQuery.proxy(this.__loadBaseCompleted,this)):"object"==typeof this.settings.loadBase&&o.BasePinCtrl.helper.ajaxGeneralRequest.call(this,this.settings.loadBase,this.__loadBaseCompleted)),void 0===this.settings.loadInfo?console.log(this.settings.name+" 無設定取即時資料"):"string"==typeof this.settings.loadInfo?o.BasePinCtrl.helper.ajaxDotnetWebserviceEmptyParas.call(this,this.settings.loadInfo,this.__loadInfoCompleted):"function"==typeof this.settings.loadInfo?this.settings.loadInfo.call(this,t,jQuery.proxy(this.__loadInfoCompleted,this)):"object"==typeof this.settings.loadInfo&&o.BasePinCtrl.helper.ajaxGeneralRequest.call(this,this.settings.loadInfo,this.__loadInfoCompleted)}},pinIcons:{water:{normal:{name:"正常",url:o.AppConfigOptions.script.gispath+"/images/meter/水位站-g.png",classes:"water_normal"},warnLevel3:{name:"三級",url:o.AppConfigOptions.script.gispath+"/images/meter/水位站-y.png",classes:"water_warnleve3"},warnLevel2:{name:"二級",url:o.AppConfigOptions.script.gispath+"/images/meter/水位站-o.png",classes:"water_warnleve2"},warnLevel1:{name:"一級",url:o.AppConfigOptions.script.gispath+"/images/meter/水位站-r.png",classes:"water_warnleve1"},noData:{name:"無資料",url:o.AppConfigOptions.script.gispath+"/images/meter/水位站-gr.png",classes:"water_nodata"}},rain:{normal:{name:"正常",url:o.AppConfigOptions.script.gispath+"/images/meter/雨量站-正常.png",classes:"rain_normal"},heavy:{name:"大雨",url:o.AppConfigOptions.script.gispath+"/images/meter/雨量站-大雨.png",classes:"rain_heavy"},extremely:{name:"豪雨",url:o.AppConfigOptions.script.gispath+"/images/meter/雨量站-豪雨.png",classes:"rain_extremely"},torrential:{name:"大豪雨",url:o.AppConfigOptions.script.gispath+"/images/meter/雨量站-大豪雨.png",classes:"rain_torrential"},extremely_torrential:{name:"超大豪雨",url:o.AppConfigOptions.script.gispath+"/images/meter/雨量站-超大豪雨.png",classes:"rain_exttorrential"},noData:{name:"無資料",url:o.AppConfigOptions.script.gispath+"/images/meter/雨量站-無資料.png",classes:"rain_nodata"}},cctv:{normal:{name:"攝影機",url:o.AppConfigOptions.script.gispath+"/images/camera.png",classes:"blue_status"}},defaultPin:{name:"圖例",url:o.AppConfigOptions.script.gispath+"/images/blue-pushpin.png",classes:"blue_status"}}};var s="BasePinCtrl",n=function(t,e){e&&(e.stopPropagation(),e.preventDefault()),this.$element=o(t),this.$__pinswitch=void 0,this.$__pinlabel=void 0,this.$__pinlist=void 0,this.settings=o.extend({},o.BasePinCtrl.defaultSettings),this.$___listJspanelElement=void 0,this.__triggerMouseEventForListTable=!0,this.___datas=void 0,this.___displaydatas=[],this.___customfilter="",this.___queryfilter="",this.isInitCompleted=!1,this.visible=!1,this._mainctrl=void 0};n.prototype={constructor:n,init:function(t){var e=o.extend({},this.settings.pinsize);o.extend(this.settings,t),this.settings.id=this.settings.id||helper.misc.geguid(),this.settings.pinsize=o.extend(e,t.pinsize),this.___customfilter=this.settings.filter,this.settings.useExport=this.settings.useExportCsv||this.settings.useExport||!1,!0===this.settings.autoReload&&(this.settings.autoReload={auto:!0,interval:3e5});var i=this;this.settings.initEvent?this.$element.on(this.settings.initEvent,function(){i.isInitCompleted||i.initMap()}):this.initMap(),this.$element.addClass(this.settings.id?"pin-"+this.settings.id:""),this.$element.addClass(this.settings.name?"pin-"+this.settings.name:""),this.$element.addClass(this.settings.classes?this.settings.classes:"")},initMap:function(){var t=this;"google"===whatMap(this.settings.map)?this.settings.type==o.BasePinCtrl.type.polygon?window.GPolygonBasePinCtrl?t._mapctrl=new GPolygonBasePinCtrl(t,function(){t.initUI()}):helper.misc.getJavaScripts([o.AppConfigOptions.script.gispath+"/ext/meter/GPolygonBasePinCtrl.js"],function(){t._mapctrl=new GPolygonBasePinCtrl(t,function(){t.initUI()})}):this.settings.type==o.BasePinCtrl.type.polyline?window.GPolylineBasePinCtrl?t._mapctrl=new GPolylineBasePinCtrl(t,function(){t.initUI()}):helper.misc.getJavaScripts([o.AppConfigOptions.script.gispath+"/ext/meter/GPolylineBasePinCtrl.js"],function(){t._mapctrl=new GPolylineBasePinCtrl(t,function(){t.initUI()})}):window.GBasePinCtrl?t._mapctrl=new GBasePinCtrl(t,function(){t.initUI()}):helper.misc.getJavaScripts([o.AppConfigOptions.script.gispath+"/ext/meter/GBasePinCtrl.js"],function(){t._mapctrl=new GBasePinCtrl(t,function(){t.initUI()})}):"leaflet"===whatMap(this.settings.map)?this.settings.type==o.BasePinCtrl.type.feature?window.LFeatureBasePinCtrl?t._mapctrl=new LFeatureBasePinCtrl(t,function(){t.initUI()}):helper.misc.getJavaScripts([o.AppConfigOptions.script.gispath+"/ext/meter/LFeatureBasePinCtrl.js"],function(){t._mapctrl=new LFeatureBasePinCtrl(t,function(){t.initUI()})}):this.settings.type==o.BasePinCtrl.type.polygon?window.LPolygonBasePinCtrl?t._mapctrl=new LPolygonBasePinCtrl(t,function(){t.initUI()}):helper.misc.getJavaScripts([o.AppConfigOptions.script.gispath+"/ext/meter/LPolygonBasePinCtrl.js"],function(){t._mapctrl=new LPolygonBasePinCtrl(t,function(){t.initUI()})}):this.settings.type==o.BasePinCtrl.type.polyline?window.LPolylineBasePinCtrl?t._mapctrl=new LPolylineBasePinCtrl(t,function(){t.initUI()}):helper.misc.getJavaScripts([o.AppConfigOptions.script.gispath+"/ext/meter/LPolylineBasePinCtrl.js"],function(){t._mapctrl=new LPolylineBasePinCtrl(t,function(){t.initUI()})}):window.LBasePinCtrl?t._mapctrl=new LBasePinCtrl(t,function(){t.initUI()}):o.getScript(o.AppConfigOptions.script.gispath+"/ext/meter/LBasePinCtrl.js",function(){t._mapctrl=new LBasePinCtrl(t,function(){t.initUI()})}):"golife"===whatMap(this.settings.map)?window.GLBasePinCtrl?t._mapctrl=new GLBasePinCtrl(t,function(){t.initUI()}):helper.misc.getJavaScripts([o.AppConfigOptions.script.gispath+"/ext/meter/GLBasePinCtrl.js"],function(){t._mapctrl=new GLBasePinCtrl(t,function(){t.initUI()})}):this.settings.type==o.BasePinCtrl.type.polygon?window.APolygonBasePinCtrl?t._mapctrl=new APolygonBasePinCtrl(t,function(){t.initUI()}):helper.misc.getJavaScripts([o.AppConfigOptions.script.gispath+"/ext/meter/APolygonBasePinCtrl.js"],function(){t._mapctrl=new APolygonBasePinCtrl(t,function(){t.initUI()})}):this.settings.type==o.BasePinCtrl.type.polyline?window.APolylineBasePinCtrl?t._mapctrl=new APolylineBasePinCtrl(t,function(){t.initUI()}):helper.misc.getJavaScripts([o.AppConfigOptions.script.gispath+"/ext/meter/APolylineBasePinCtrl.js"],function(){t._mapctrl=new APolylineBasePinCtrl(t,function(){t.initUI()})}):window.ABasePinCtrl?t._mapctrl=new ABasePinCtrl(t,function(){t.initUI()}):o.getScript(o.AppConfigOptions.script.gispath+"/ext/meter/ABasePinCtrl.js",function(){t._mapctrl=new ABasePinCtrl(t,function(){t.initUI()})})},__checkCtrlEnableForZoomLevel:function(t){var e=this,i=e.$__pinswitch.is(":checked");0==e.settings.minZoom&&19==e.settings.maxZoom||(t<e.settings.minZoom||t>e.settings.maxZoom?(e.$__pinswitch.attr("disabled",!0),e.$__pinlabel.attr("disabled",!0),e.$__pinlist.attr("disabled",!0),e.$___listJspanelElement&&e.$___listJspanelElement.is(":visible")&&e.$___listJspanelElement.hide()):(e.$__pinswitch.attr("disabled",!1),e.$__pinlabel.attr("disabled",!i),e.$__pinlist.attr("disabled",!i),e.$___listJspanelElement&&e.$__pinlist.is(":checked")&&e.$__pinlist.trigger("change")),i&&(e.show(),e.$__pinlabel.trigger("change")))},initUI:function(){var l=this;setTimeout(function(){var a;null!=l.settings.pinClick&&(l._mapctrl.pinClick=l.settings.pinClick),l._mapctrl.onFocusRowIndex=function(t){if(l.$___listJspanelElement){var e=o(".fixed-table-body tbody tr[data-index="+t+"]:eq(0)",l.$___listJspanelElement.$listBootstrapTable);if(e&&0<e.length){e.height();var i=!l.$___listJspanelElement.$listBootstrapTable.find(".fixed-table-header>table>thead:eq(0)").is(":visible");l.___scrollContenTop.call(l,e[0].offsetTop-(i?20:60)),e.addClass("meter-active")}else if(-1<t&&1==l.settings.listOptions.virtualScroll){var s=0,n=o(".fixed-table-body tbody tr:eq(0)",l.$___listJspanelElement.$listBootstrapTable);n.hasClass("virtual-scroll-top")?(s=n.height(),s+=(n=o(".fixed-table-body tbody tr:eq(1)",l.$___listJspanelElement.$listBootstrapTable)).height()*(t-n.attr("data-index"))):s=t*n.height(),l.___scrollContenTop.call(l,s),clearTimeout(a),a=setTimeout(function(){l.___listenTableMouseEvent(),l._mapctrl.onFocusRowIndex(t)})}}},l._mapctrl.offFocusRowIndex=function(t){if(l.$___listJspanelElement)o(".fixed-table-body tbody tr[data-index]",l.$___listJspanelElement.$listBootstrapTable).removeClass("meter-active")},l._mapctrl.onMapZoomEnd=function(t){l.__checkCtrlEnableForZoomLevel(t)},l.__checkCtrlEnableForZoomLevel(l._mapctrl.getCurrentZoomlevel())});var i,s,t=this.settings.useLabel||this.settings.useList?6:12,e='<div class="col-xs-12 col-12 ctrl"><label class="col-xs-'+t+" col-"+t+'"><input type="checkbox" class="pinswitch"><span class="checkbox-glyphicon base-background  btn-sm  glyphicon "></span><span class="checkbox-name">'+this.settings.name+"</span></label>";this.settings.useLabel&&(e+='<label class="col-xs-3 col-3"><input type="checkbox" disabled class="pinlabel"><span class="checkbox-glyphicon base-background  btn-sm glyphicon"></span><span class="checkbox-name">標籤</span></label>'),this.settings.useList&&(e+='<label class="col-xs-3 col-3"><input type="checkbox" disabled class="pinlist"><span class="checkbox-glyphicon base-background  btn-sm glyphicon"></span><span class="checkbox-name">清單</span></label>'),e+="</div>",this.$element.addClass("pinctrl"),this.$element.attr("id")||this.$element.attr("id",this.settings.id),this.$element.append(e),this.repaintLegendUI(),this.$__pinswitch=o("input.pinswitch",this.$element),this.$__pinlabel=o("input.pinlabel",this.$element),this.$__pinlist=o("input.pinlist",this.$element),this.$__pinswitch.on("change",function(){var t=o(this).is(":checked");l.$__pinlist.is(":checked");if(t?(l.visible=!0,l._mapctrl.visible=!0):(l.visible=!1,l._mapctrl.visible=!1),o("input.pinlabel",l.$element).attr("disabled",!t),o("input.pinlist",l.$element).attr("disabled",!t),l.settings.map){l.isInitCompleted||(l.$element.show_busyIndicator({timeout:2e4}),l.___datas&&l.setData(l.___datas),l.$element.trigger(o.BasePinCtrl.eventKeys.initLayer,!0)),l.isInitCompleted=!0,t?l.show():l.hide(),l.$element.trigger(o.BasePinCtrl.eventKeys.displayLayer,t);var e=function(){(new Date).getTime()-s>=l.settings.autoReload.interval&&(l.$element.trigger(o.BasePinCtrl.eventKeys.initLayer,!0),s=(new Date).getTime()),i=setTimeout(e,l.settings.autoReload.interval)};l.settings.autoReload.auto&&(l.visible?(s||(s=(new Date).getTime()),e()):clearTimeout(i))}}),this.$__pinlabel.on("change",function(){var t=l.isShowLabel(),e=l.$__pinlabel.is(":disabled");l._mapctrl.showLabel(t&&!e)}),this.$__pinlist.on("change",function(){var t=o(this).is(":checked");(new Date).getTime();if(t&&!l.$___listJspanelElement){var e=[];l.settings.useSearch&&e.push({item:'<span class="glyphicon glyphicon-search" title="搜尋"></span>',event:"click",callback:function(){o(this).val();o(".fixed-table-toolbar .search",l.$___listJspanelElement.$listBootstrapTable).toggleClass("active").toggle("blind",function(){l.___resizeTable(),l.___scrollContenTop.call(l,0)})}}),l.settings.useCardview&&e.push({item:'<span class="glyphicon glyphicon-list-alt icon-list-alt" title="檢視切換"></span>',event:"click",callback:function(){200<l.___displaydatas.length&&l.$___listJspanelElement.show_busyIndicator(),setTimeout(function(){o("button[name=toggle]",l.$___listJspanelElement).trigger("click"),setTimeout(function(){o(".fixed-table-header",this.$___listJspanelElement).css("border-bottom-color","").css("border-bottom-width",""),l.$___listJspanelElement.hide_busyIndicator()},100)},10)}}),l.settings.useExport&&e.push({item:'<span class="glyphicon glyphicon-floppy-save " title="下載"></span>',event:"click",callback:function(){1==l.settings.useExport?helper.misc.tableToExcel(l.$___listJspanelElement.$table,[l.settings.name],l.settings.name):"object"==typeof l.settings.useExport?(l.settings.useExport.filename=l.settings.useExport.filename||l.settings.name,l.settings.useExport.sheetname=l.settings.useExport.sheetname||l.settings.name,helper.misc.tableToExcel(l.$___listJspanelElement.$table,[l.settings.useExport.sheetname],l.settings.useExport.filename,l.settings.useExport.csv)):"function"==typeof l.settings.useExport&&l.settings.useExport(l.$___listJspanelElement.$table)}}),l.settings.appendCustomToolbarHeader&&o.each(l.settings.appendCustomToolbarHeader,function(){e.push(this)}),e.push({item:'<span class="meter-list-count"></span>'});var i=l.___getLocalCache()||{};i.top&&window.outerHeight-i.top<70&&(i.top=window.outerHeight-70),i.left&&window.outerWidth-i.left<200&&(i.left=window.outerWidth-200),void 0===l.pinctrlid&&(l.pinctrlid=l.settings.layerid+"_"+(new Date).getTime()),l.$___listJspanelElement=("inner"==l.settings.listContainer?l.$element:o(l.settings.listContainer)).jsPanel({id:"jsp_"+l.pinctrlid,title:l.settings.name,theme:l.settings.listTheme,classes:"pin-list-container pin-list-container-"+l.settings.name,size:{width:i.width?i.width:"250",height:i.height?i.height:"300"},overflow:"hidden",draggable:{stop:function(t,e){o(t.target).css("opacity","")}},position:{top:i.top?i.top+"px":"60px",left:i.left?i.left+"px":"center"},controls:{buttons:"closeonly",iconfont:"bootstrap"},content:'<table id="metertable_'+l.pinctrlid+'" class="col-xs-12 col-12"></table>',toolbarHeader:e}).mouseenter(function(){l.$___listJspanelElement.front()}).on("resizestart",function(){window.jspanel_resize_drag=!0}).on("resizestop",function(){window.jspanel_resize_drag=!1,l.___setLocalCache({width:l.$___listJspanelElement.width(),height:l.$___listJspanelElement.height()}),l.___resizeTable()}).on("dragstart",function(){window.jspanel_resize_drag=!0}).on("dragstop",function(){window.jspanel_resize_drag=!1,l.___setLocalCache({top:l.$___listJspanelElement.position().top,left:l.$___listJspanelElement.position().left})}).on("onjspanelloaded",function(){var t=o(this);if(t.position().left<0&&t.css("left",0),t.position().top<0&&t.css("top",0),"inner"==l.settings.listContainer)l.$___listJspanelElement.addClass("inner-jsPanel"),l.$___listJspanelElement.find("> .jsPanel-hdr > .jsPanel-hdr-l").hide(),l.$___listJspanelElement.find("> .jsPanel-hdr > .jsPanel-hdr-r").hide(),l.$___listJspanelElement.find("> .ui-resizable-handle").remove();else{l.$___listJspanelElement.front();var e=o(".fix-popu-ctrl-toleft.fixed-show");0<e.length&&0==t.position().left&&t.css("left",e.width()-100)}}),l.$___meterListCount=o(".meter-list-count",l.$___listJspanelElement),o(".jsPanel-hdr-r .jsPanel-hdr-r-btn-close",l.$___listJspanelElement).unbind("click").on("click",function(){o("input.pinlist",l.$element).prop("checked",!1).trigger("change")});var s=function(){var t=o(".fixed-table-toolbar .search input",l.$___listJspanelElement.$listBootstrapTable),i=0;setTimeout(function(){t.off("keyup drop blur").on("keyup drop blur",function(t){clearTimeout(i);var e=1.5*l.___datas.length;e=1200<e?1200:e,e=t.keyCode&&13==t.keyCode?0:e,i=setTimeout(o.proxy(l.setFilter,l,l.___customfilter,o(t.currentTarget).val()),e)})},1e3)};l.$element.show_busyIndicator(),o("").bootstrapTable?l._initListTable(s):helper.misc.getJavaScripts([o.AppConfigOptions.script.gispath+"/bootstraptable/bootstrap-table.js"],function(){l._initListTable(s)}),setTimeout(function(){l.$___listJspanelElement.front()},100),l.$___listJspanelElement.mouseenter(function(){l.$___listJspanelElement.front()})}t?(l.$___listJspanelElement.show(),l.___resizeTable()):l.$___listJspanelElement&&l.$___listJspanelElement.hide()}),this.$element.trigger(o.BasePinCtrl.eventKeys.initUICompleted)},_initListTable:function(t){var e,i=this;o.each(i.settings.infoFields,function(){this.visible=this.showInList});var s=o.extend({height:200,striped:!1,search:!0,showToggle:!0,cardView:i.settings.defalutCardview,columns:i.settings.infoFields,data:i.___displaydatas?i.___displaydatas:[],rowStyle:o.proxy(i.settings.checkDataStatus,i),onClickRow:function(t,e){i.__triggerMouseEventForListTable&&i.settings.useInfoWindow&&i._mapctrl.showInfoWindow(i._mapctrl.getGraphicByRindex(t.rindex),!0)},onSort:function(t,e){return setTimeout(function(){var t=i.$___listJspanelElement.$table.bootstrapTable("getData");o.each(t,function(t,e){this.rindex=t})},10),!1},formatNoMatches:function(){return"無資料!!"},formatSearch:function(){return"搜尋"},onPostBody:function(){i.___listenTableMouseEvent()},onScrollBody:function(t){s.virtualScroll&&(clearTimeout(e),e=setTimeout(function(){i.___listenTableMouseEvent()},200))}},i.settings.listOptions);s.classes||(s.classes="table table-hover"),i.$___listJspanelElement.$table=o("#metertable_"+i.pinctrlid).bootstrapTable(s),i.$___listJspanelElement.$listBootstrapTable=i.$___listJspanelElement.$table.parents(".bootstrap-table").first().addClass("metertable"),i.___resizeTable(),i.$element.hide_busyIndicator(),t&&t()},setFocusPoint:function(t,e){var i=this;o.each(i.___displaydatas,function(){if(this[e]===t[e]||this[e]===t)return i.settings.useInfoWindow&&i._mapctrl.showInfoWindow(i._mapctrl.getGraphicByRindex(this.rindex),!0),!1})},removeFocusPoint:function(t,e){var i=this;t&&void 0!==e?o.each(i.___displaydatas,function(){if(this[e]===t[e])return i.settings.useInfoWindow&&i._mapctrl.closeInfoWindow(i._mapctrl.getGraphicByRindex(this.rindex)),!1}):i._mapctrl.closeInfoWindow()},setBoundary:function(t){this.settings.boundary=t,this.setFilter(this.___customfilter,this.___queryfilter,!0)},fitBounds:function(t){this._mapctrl.fitBounds&&this._mapctrl.fitBounds(t)},setFilter:function(i,s,t){var n=this;if(void 0===s&&(s=this.___queryfilter),"boolean"==typeof s&&(t=s,s=this.___queryfilter),t||i!==this.___customfilter||s!==this.___queryfilter){if(this.___queryfilter=s,"function"!=typeof(this.___customfilter=i)&&i&&(i=i.toLowerCase()),s&&(s=s.toLowerCase()),this.___displaydatas=[],this.___datas&&0<this.___datas.length){var a=void 0;this.settings.enabledStatusFilter&&(a=o.map(this.$element.find(".legend-disable"),function(t){return o(t).text()})),this.___displaydatas=o.grep(this.___datas,function(t){if(a&&0<a.length){var e=n.settings.checkDataStatus.call(n,t);if(null!=e&&0<=a.indexOf(o("<div>"+e.name+"</div>").text()))return!1}if(n.settings.boundary&&!helper.gis.pointInPolygon([t.X,t.Y],n.settings.boundary))return!1;return"function"==typeof i?i(t)&&n.___filterItemText(t,s):n.___filterItemText(t,i)&&n.___filterItemText(t,s)})}this.___repaint()}},setData:function(t){var i=this;(this.___datas=t)&&0<t.length&&0==this.settings.infoFields.length&&o.each(t[0],function(t,e){i.settings.infoFields.push({field:t,title:t})}),this.setFilter(this.___customfilter,this.___queryfilter,!0),this.$element.trigger(o.BasePinCtrl.eventKeys.afterSetdata,[this.___datas,this.___displaydatas])},add:function(t){if(this._mapctrl){this.___datas=this.___datas||[],this.___datas.push(t),this.___displaydatas.push(t),this._mapctrl.add?(this._mapctrl.add(t),this.$___listJspanelElement&&this.$___listJspanelElement.$table.bootstrapTable("load",this.___displaydatas)):alert("this._mapctrl尚未實作add")}},remove:function(t){var e=-1;0<=(e=this.___datas.indexOf(t))&&this.___datas.splice(e,1),0<=(e=this.___displaydatas.indexOf(t))&&this.___displaydatas.splice(e,1),this._mapctrl.remove?(this._mapctrl.remove(t),this.$___listJspanelElement&&this.$___listJspanelElement.$table.bootstrapTable("load",this.___displaydatas)):alert("this._mapctrl尚未實作add")},setOpacity:function(t){this._mapctrl.setOpacity(t)},legendContainer:void 0,repaintLegendUI:function(t){var n=this,a=void 0,e=this.$element;this.settings.legendContainer&&(e=this.settings.legendContainer,"string"==typeof this.settings.legendContainer&&(e=this.settings.legendContainer=o(this.settings.legendContainer))),0==(a=o(".legend-"+this.settings.id,e)).length&&(a=o('<div class="legend legend-'+this.settings.id+'">').appendTo(e)),a.empty(),t&&(this.settings.legendIcons=t),this.settings.legendIcons&&(o.each(this.settings.legendIcons,function(t,e){if(n.settings.type==o.BasePinCtrl.type.point){var i=o('<div><span class="legend-name">'+e.name+"</span></div>").addClass("legend-icon"+(e.disabled?" legend-disable default-disabled":""));a.append(i),i[0].style.backgroundImage="url('"+(e.url||e.iconUrl)+"')",e.prefix&&e.glyph&&(e.iconUrl&&i.addClass("glyph-icon"),i.addClass("glyph"),o('<span class="'+e.prefix+" "+e.glyph+" "+e.classes+'"></span>').prependTo(i))}else if(n.settings.type==o.BasePinCtrl.type.polygon){var s=o('<span class="legend-icon'+(e.disabled?" legend-disable default-disabled":"")+'"><div></div><span class="legend-name">'+e.name+"</span></span>").appendTo(a).find("> div").css("display","inline-flex").css("vertical-align","sub");o('<svg width="26px" height="14px"><g><path></path></g></svg>').appendTo(s).find("path").attr("stroke",this.strokeColor).attr("stroke-opacity",this.strokeOpacity).attr("stroke-width",this.strokeWeight<2?2:this.strokeWeight).attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke-dasharray","0").attr("fill",this.fillColor).attr("fill-opacity",this.fillOpacity).attr("d","M0 7 L7 2 L10 0 L23 0 L26 3 L26 11 L23 14 L3 14 L0 14 Z"),e.disabled&&s.addClass("legend-disable default-disabled")}else if(n.settings.type==o.BasePinCtrl.type.polyline){s=o('<span class="legend-icon'+(e.disabled?" legend-disable default-disabled":"")+'"><div></div><span class="legend-name">'+e.name+"</span></span>").appendTo(a).find("> div").css("display","inline-flex").css("vertical-align","sub");o('<svg width="26px" height="14px"><g><path></path></g></svg>').appendTo(s).find("path").attr("stroke",this.strokeColor).attr("stroke-opacity",1).attr("stroke-width",this.strokeWeight).attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke-dasharray","0").attr("fill","none").attr("d","M0 4L9 11L18 4L26 11")}}),o.each(o(".glyph > span",a),function(){var t=window.getComputedStyle(this);t.backgroundColor&&(this.style.color=t.backgroundColor),this.style.backgroundColor="transparent"}),1<this.settings.legendIcons.length&&this.settings.enabledStatusFilter&&a.find(".legend-icon").addClass("legend-enabled-control").off("click").on("click",function(){o(this).toggleClass("legend-disable"),n.enabledStatusFilterSetDataTime&&clearTimeout(n.enabledStatusFilterSetDataTime),n.enabledStatusFilterSetDataTime=setTimeout(function(){n.___datas&&(n.$element.show_busyIndicator(),setTimeout(function(){n.setData(n.___datas)},10))},10)})),this._legenddisplay()},___setLocalCache:function(t){o.localCache.set(this.settings.name+"_list",o.extend(o.localCache.get(this.settings.name+"_list"),t))},___getLocalCache:function(){return o.localCache.get(this.settings.name+"_list")},___repaint:function(){if(this._mapctrl){var t=this;if(this._mapctrl.reDraw(t.___displaydatas),t.visible?t.show():t.hide(),this.isShowLabel&&t._mapctrl.showLabel(t.isShowLabel()),t.$___listJspanelElement){var e=function(){t.$___listJspanelElement.$table?(t.$___listJspanelElement.$table.bootstrapTable("load",t.___displaydatas),t.$element.trigger(o.BasePinCtrl.eventKeys.repaintPinCompleted,[t.___displaydatas])):setTimeout(e,100)};e()}else t.$element.trigger(o.BasePinCtrl.eventKeys.repaintPinCompleted,[t.___displaydatas]);t.$element.hide_busyIndicator(!0)}},___resizeTable:function(){var e=this;e.$___listJspanelElement.$table&&setTimeout(function(){var t=o(".fixed-table-toolbar .search.active",e.$___listJspanelElement);e.$___listJspanelElement.$table.bootstrapTable("resetView",{height:o(".jsPanel-content",e.$___listJspanelElement).height()-(t.length,0)}),setTimeout(function(){o(".fixed-table-header",e.$___listJspanelElement.$listBootstrapTable).css("border-bottom-color","").css("border-bottom-width","")})})},___listenTableMouseEvent:function(){var e,i=this;o("tbody tr",this.$___listJspanelElement.$table).off("mouseover").on("mouseover",function(){if(i.__triggerMouseEventForListTable){var t=o(this).attr("data-index");i._mapctrl.offFocusGraphic(e,!0),e=i._mapctrl.getGraphicByRindex(t),i._mapctrl.onFocusGraphic(e,!0)}}).off("mouseleave").on("mouseleave",function(){var t=o(this).attr("data-index");i._mapctrl.offFocusGraphic(i._mapctrl.getGraphicByRindex(t),!0)}),o("tbody",this.$___listJspanelElement.$table).off("mouseleave").on("mouseleave",function(){i.__triggerMouseEventForListTable&&i._mapctrl.offFocusGraphic(e,!0)}),i.$___meterListCount.html(this.___displaydatas.length)},___scrollContenTop:function(t){o(".fixed-table-body",this.$___listJspanelElement.$listBootstrapTable)[0].scrollTop=t},___filterItemText:function(t,e){if(e){var i=e.toLowerCase();for(var s in t)if(("string"==typeof t[s]||"number"==typeof t[s])&&-1!==(t[s]+"").toLowerCase().indexOf(i))return!0;return!1}return!0},show:function(){if(this.isInitCompleted){this.settings.map.getZoom();var t=this.$__pinswitch.is(":disabled");this._mapctrl.show(!t),this._legenddisplay(),this.$element.trigger(o.BasePinCtrl.eventKeys.pinShowChange,[!t])}},hide:function(){this.isInitCompleted&&(this._mapctrl.show(!1),this.$__pinlabel&&(this.$__pinlabel.prop("checked",!1),this.$__pinlabel.trigger("change")),this.$__pinlist&&(this.$__pinlist.prop("checked",!1),this.$__pinlist.trigger("change")),this._legenddisplay(),this.$element.trigger(o.BasePinCtrl.eventKeys.pinShowChange,[!1]))},_legenddisplay:function(){this.settings.legendContainer&&(!!this.$__pinswitch&&this.$__pinswitch.is(":checked")?this.settings.legendContainer.find(".legend-"+this.settings.id).removeClass("offdisplay"):this.settings.legendContainer.find(".legend-"+this.settings.id).addClass("offdisplay"))},isShowLabel:function(){return!!this.$__pinlabel&&this.$__pinlabel.is(":checked")}},o.fn[s]=function(t){var e,i;return this.data(s)instanceof n||this.data(s,new n(this[0])),i=this.data(s),void 0===t||"object"==typeof t?("function"==typeof i.init&&i.init(t),this.instance=i,this):"string"==typeof t&&"function"==typeof i[t]?(e=Array.prototype.slice.call(arguments,1),i[t].apply(i,e)):void o.error("Method "+t+" does not exist on jQuery."+s)}}(jQuery)